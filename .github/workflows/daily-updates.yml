# https://github.com/jasonetco/jasonetco/blob/master/.github/workflows/daily-updates.yml

name: Daily Updates

on:
  schedule:
    - cron: 55 5 * * * # “At every 05:55.”
  push:
    branches:
      - main

jobs:
  updates:
    name: Daily Updates
    runs-on: ubuntu-latest
    steps:
      - name: GitHub Script
        uses: actions/github-script@v6
        with:
          github-token: ${{ secrets.USER_SCOPE_PERSONAL_ACCESS_TOKEN }}
          script: |
            const query = `mutation changeUserStatus ($input: ChangeUserStatusInput!) {
              changeUserStatus (input: $input) {
                status {
                  emoji
                  message
                }
              }
            }`

            const dayNames = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday']
            const kaomojis = ['٩(◕‿◕)۶', '＼(〇_ｏ)／', '٩(× ×)۶', '(ᗒᗣᗕ)՞', 'ʕ •ᴥ• ʔ', 'ヽ(♡‿♡)ノ', '☆*:.｡.o(≧▽≦)o.｡.:*☆']
            const emojis = ['😊', '🥺', '🤔', '😣', '🐻', '😍', '🥰']
            const dayIndex = (new Date()).getDay()
            const limitedAvailabilityDayNames = new Set(["Friday", "Saturday", "Sunday"]);
            bool hasLimitedAvailability = false;
            if(limitedAvailabilityDayNames.has(dayNames[dayIndex])){
                limitedAvailability = true;
            }

            github.graphql(query, {
              input: {
                emoji: `${emojis[dayIndex]}`,
                message: `It's ${dayNames[dayIndex]}! ${kaomojis[dayIndex]}`
                limitedAvailability: hasLimitedAvailability
              }
            })
